HTTP

| 功能         | 请求方式 |      |      |
| ------------ | -------- | ---- | ---- |
| 设备认证     | POST     |      |      |
| 下载升级包   | GET      |      |      |
| 上传图片     | POST     |      |      |
| 上传日志文件 | POST     |      |      |



MQTT

| 主题                                                  |                                                              | 服务端/客户端 |
| ----------------------------------------------------- | ------------------------------------------------------------ | ------------- |
| 连接                                                  | MQTT<clientid：barCode, username："00000",  password: token  | C             |
| 1、发起拍照iob/s2d/job/{barCode}                      | job_time、job_id、cam_id、exposure、brightness_thresh、diff_thresh、id、method、period_ns、duty_ns | S             |
| iob/s2d/man_job/{barCode}                             |                                                              | S             |
| 上传拍照结果iob/job_result/{barCode}                  | job_id、cam_id、device_id、cap_time、exposure、format、file_size、resolution、brightness_thresh、frame_diff、error_code、power_remain、filename、gradient、confidence、box_action、category、diff_switch、area_vacancy | C             |
| 2、第三方拍照iob/s2d/job/{barCode}                    | job_id、order_no、job_time、cam_id、method、category、confidence、diff_switch、exposure、brightness_thresh、diff_thresh、duty_ns | S             |
| 3、打开传递口iob/s2d/open/{barCode}                   | barCode、orderNo                                             | S             |
| 打开传递口结果iob/d2s/open/result                     | barCode、orderNo、type                                       | C             |
| 5、打开运维锁iob/s2d/openLock/{barCode}               | type                                                         | S             |
| 6、关闭运维锁iob/s2d/close/{barCode}                  | barCode、orderNo、type                                       | S             |
| 关闭运维锁iob/s2d/close/{barCode}                     | barCode、orderNo、type、count                                | C             |
| 上传投递状态iob/d2s/upload/finish/{barCode}           | orderNo 订单号(投递号)<br/>type 0 结束投递<br/>1 超时结束投递<br/>count 为上次投递数量<br/>keyOpenStatus 投递⼝状态 0 开;1关 | C             |
| 上报告警iob/d2s/alarm/{barCode}                       | context:错误码,<br/>area_vacancy:10,<br/>power_remain:80<br/>power_voltage： 4039000<br/>barcode:{barCode} | C             |
| 设备状态iob/d2s/device/status/{barCode}               | area_vacancy 为满空情况 0 - 100<br/>power_remain 电量  0-100<br/>power_voltage 电压<br/>cameSerialCode 相机节点名称<br/>simCode  4G sim卡号<br/>csq  4G 信号<br/>lng GPS经度<br/>lat GPS维度<br/>acc 陀螺仪加速度<br/>gyro  陀螺仪三轴<br/>temp 陀螺仪温度 | C             |
| 相机状态 iob/status/camera                            | barCode:{barCode}<br/>video0:1,<br/>                         | C             |
| 7、参数下发iob/s2d/update_param/{barCode}             |                                                              | S             |
| 8、iob/s2d/all_update_param                           |                                                              | S             |
| 参数下发结果返回iob/d2s/update_param_result/{barCode} | "req": "112",<br/>"result": "True",<br/>"barCode": "{barCode} | C             |
| 9、取设备参数iob/s2d/get_params/{barCode}             |                                                              | S             |
| 上传参数iob/d2s/upload_params/{barCode}               |                                                              | C             |
| 10、设备重启 iob/s2d/reset/{barCode}                  | type:{type}                                                  | S             |
| 11、App升级  iob/update/{barCode}                     |                                                              | S             |
| 12、iob/update_all                                    |                                                              | S             |
| App升级发布主题： iob/report/version/{barCode}        | update_type: firmware 固件; app 应⽤<br/>action: upgrade 升级; rollback 回退<br/>version: 版本号<br/>filename:⽂件名称 | C             |
| 设备上报版信息  iob/report/version/{barCode}          | barCode:{barCode}<br/>version:{version}<br/>buildDate:{buildDate}<br/>gitVer:{gitVer} | C             |
| 13、获取日志文件列表iob/s2d/logfile/{barCode}         |                                                              | S             |
| 上传日志信息列表iob/d2s/loginfo/{barCode}             | fileName ⽇志⽂件名称<br/>fileSize ⽇志⽂件⼤⼩              | C             |
| 14、获取日志信息 iob/s2d/logfile/{barCode}            | fileName 需要上传的⽇志⽂件名称                              | S             |



bug ：mqtt断联后，无法重连，只能重连tcp

sprintf(g_publictTopic,"iob/job_result/%s",g_barCode);
		}
		break;
		case DELY_RESULT:
		{
			sprintf(g_publictTopic,"iob/d2s/open/result");
		}
		break;
		case DELY_CLOSE:
		{
			sprintf(g_publictTopic,"iob/d2s/close/%s",g_barCode);
		}
		break;
		case DELY_STA:
		{
			sprintf(g_publictTopic,"iob/d2s/upload/finish/%s",g_barCode);
		}
		break;
		case ALARM_TYPE:
		{
			sprintf(g_publictTopic,"iob/d2s/alarm/%s",g_barCode);
		}
		break;
		case DEVICE_STA:
		{
			sprintf(g_publictTopic,"iob/d2s/device/status/%s",g_barCode);
		}
		break;
		case CAMEAR_STA:
		{
			sprintf(g_publictTopic,"iob/status/camera");
		}
		break;
		case PARAM_RESULT:
		{
			sprintf(g_publictTopic,"iob/d2s/update_param_result/%s",g_barCode);
		}
		break;
		case PARAM_UPLOAD:
		{
			sprintf(g_publictTopic,"iob/d2s/upload_params/%s",g_barCode);
		}
		break;
		

		case DEVICE_VERSION:
		{
			sprintf(g_publictTopic,"iob/report/version/%s",g_barCode);
		}
		break;
		case LOG_LIST:
		{
			sprintf(g_publictTopic,"iob/d2s/loginfo/%s",g_barCode);
		}